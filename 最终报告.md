# C语言实验-酒店预订管理系统
## 功能说明及任务
- 管理员
    - [x] 基本信息管理
        - [x] 客房
    		- [x] 增加
			- [x] 删除
			- [x] 修改
        - [x] 客人
    		- [x] 增加
			```c
			void add_room_type()
			{
				TYPE_ROOM* head = read_from_file("D:\\code\\vs2022\\c语言实验设计\\data.txt");
				TYPE_ROOM* curr = head;
				while (curr)
					curr = curr->next;
				curr = (TYPE_ROOM*)malloc(sizeof(TYPE_ROOM));
				int num;
				float size;
				char typename[100];
				int ID;
				double price;
				char status[20];
				char location[20];
				printf("输入该类型房间数量，大小以及类型名：");
				scanf("%d%f%s", &num, &size, typename);
				printf("依次输入该类型下各房间信息（包含房间号，价格，状态，位置）,英文逗号相隔");
				for (int i = 0; i < num; i++)
				{
					scanf("%d,%f,%[^,],%[^,\n]\n", &ID,&price,status,location);
					curr->room=single_connect(curr->room, ID, price, status, location);
					curr = curr->next;
				}
				curr->next = NULL;
				write_to_file(head, "D:\\code\\vs2022\\c语言实验设计\\data.txt");
			}
			```
			- [x] 删除
			- [x] 修改
    - [x] 信息设置管理
        - [x] 调整房间类型
        - [x] 调整客人类型
        - [x] 设置房间价格
        - [x] 设置折扣程度

    - [ ] 信息查询
        - [ ] 简单查询
        - [ ] 组合查询
        - [ ] 模糊查询

    - [ ] 信息排序
        - [ ] 单一属性
        - [ ] 多属性

    - [ ] 信息统计
        - [ ] 单一属性
        - [ ] 多属性
        - [ ] 预设统计
        - [ ] 条件统计

    - [ ] 系统维护
        - [ ] 重置密码
        - [ ] 找回密码
        - [ ] 数据备份
        - [ ] 数据恢复
- 前台
    -[ ]

- 客人
    -[ ]

### 前端账户注册登录
需要有一个txt文件存储所有人的账密信息,即member.txt 需要一个函数能够从该文件中读取信息
```c
MEMBER* member_data(const char* filename)
{
	FILE* fp;
	if ((fp = fopen(filename, "r")) == NULL)		//注意=与==的优先级，不加括号会将fopen(filename, "r") == NULL的结果赋给fp导致无法正常打开文件
	{
		printf("Failed to open the file");
		exit(0);
	}
	MEMBER* head = NULL, * tail = NULL;
	char account[20];
	char password[20];
	while (fscanf(fp, "%[^,],%[^,\n]\n",account,password) == 2)			//%[^,] 意为自由读取直到遇到','(不读取逗号)  然后跳过逗号  [^,\n]因为在读取最后一个数时会读入\n，也要跳过
	{
		MEMBER* new = (MEMBER*)malloc(sizeof(MEMBER));
		strcpy(new->account, account);
		strcpy(new->password, password);
		if (head == NULL)
		{
			head = new;
			head->next = NULL;
			tail = new;
		}
		else
		{
			tail->next = new;
			tail = new;
		}
	}
	tail->next = NULL;
	fclose(fp);
	return head;
}
```
>该函数返回一个头指针,指向一个存放了账密信息的链表,方便检查用户是否存在账号或者是否登陆成功

有了读取文件的函数,自然也需要一个函数来将程序运行中修改的数据体现在文件上,于是有了写入函数
```c
void member_write_to_file(const char* filename, char* account, char* password)
{
	FILE* fp = fopen(filename, "a+");		
	if (fp == NULL)
	{
		printf("Open failed\n");
		return;		//void型return后不加0
	}
	fprintf(fp, "%s,%s\n", account, password);
	printf("注册成功！\n");
	fclose(fp);
}
```
>这个函数无返回值,其作用是将链表中的信息依次写入到文件中实现文件的更新

登陆首先要注册一个账号,利用regist_member函数,让用户输入账号密码再将其写入文件实现注册
```c
void regist_member()
{
	FILE* fp;
	if ((fp = fopen("D:\\code\\vs2022\\c语言实验设计\\manager.txt", "a+")) == NULL)
	{
		printf("系统崩溃啦!");
		return 0;
	}
	char hide;
	int i = 0;
	char acc[20];
	char pas[20];
	printf("请输入账号：");
	scanf("%s", acc);
	printf("请输入密码：");
	while (1)
	{
		hide = getch();
		if (hide == 13)//13对应"\r" 回车
		{
			pas[i] = '\0';
			break;
		}
		else if (hide == 8 && i > 0)//ascii 8对应"\b"退格
		{
			i--;
			printf("\b \b");
		}
		else if (i < 20)
		{
			pas[i] = hide;
			i++;
			printf("*");
		}
	}
	printf("\n");
	member_write_to_file("D:\\code\\vs2022\\c语言实验设计\\member.txt", acc, pas);
}
```

注册完账号,就要开始登陆系统,由以下两个函数构成
```c
int ifcorrect(MEMBER* head,char *account,char *password)
{
	MEMBER* curr = head;
	while (curr)
	{
		if (strcmp(curr->account, account) == 0)
		{
			if (strcmp(curr->password, password) == 0)
			{
				return 1;
			}
		}
		curr = curr->next;
	}
	printf("登陆失败\n");
	return 0;
}
```
>判断输入的账号密码是否对应
```c
int log_in_member()
{
	MEMBER* head = member_data("D:\\code\\vs2022\\c语言实验设计\\member.txt");
	char account[20];
	char password[20];
	char hide;
	int i = 0;
	printf("请输入账号:");
	scanf("%20s", account);
	printf("是否显示密码:\n");
	printf("0.显示\n");
	printf("1.不显示\n");
	int ifdisplay;
	scanf("%d", &ifdisplay);
	if (ifdisplay)
	{
		printf("请输入密码:");
		while (1)
		{
			hide = getch();
			if (hide == 13)//13对应"\r" 回车
			{
				password[i] = '\0';
				break;
			}
			else if (hide == 8 && i > 0)//ascii 8对应"\b"退格
			{
				i--;
				printf("\b \b");
			}
			else if (i < 20)
			{
				password[i] = hide;
				i++;
				printf("*");
			}
		}
		printf("\n");
	}
	else
	{
		printf("请输入密码:");
		scanf("%s", password);
	}
	
	if (ifcorrect(head, account, password))
	{
		printf("登陆成功！\n");
		return 1;
	}
	else
		return 0;
}
```
>输入0或1,让用户自行选择是否隐藏密码,

以上为登陆系统的相关代码,诸如更改密码等操作在三种身份的系统维护中均有介绍

----

### 结构体与枚举变量的声明
- 枚举变量
    >枚举变量在该系统中十分常见,如客户vip等级,房间状态等,同时也能一定程度简化代码
	
	- 房间位置
	```c
	enum LOCATION
	{
		north,
		south,
		near_lift,
		near_corner
	};
	```
	- VIP等级
	```c
	enum VIP_LEVEL
	{
		black,
		gold,
		silver,
		common,
	};
	```
	- 客人状态
	```c
	enum STATUS_CUS
	{
		CUS_available,
    	CUS_reserved,
    	living,
    	leave,
	};
	```
	- 房间状态
	```c
	enum STATUS_ROOM
	{
    	ROOM_available,
    	ROOM_reserved,
    	check_in,
	};
	```
- 结构体
	>结构体分为三种,两种关于房间,一种关于客人,房间分为不同类型,不同类型下有不同房间,因此采用结构体嵌套定义
	- 单个房间

	```c
	typedef struct Single_room
	{
		int ID;
		double price;
		enum STATUS_ROOM status;
		enum LOCATION location;
		struct Single_room* next;
	}Single_room;
	```
	- 房间类型
	```c
	typedef struct TYPE_ROOM
	{
		int num;
		float size;
		char typename[100];
		Single_room* room;
		struct TYPE_ROOM* next;
	}TYPE_ROOM;
	```
	> 在TYPE_ROOM和Single_room中都留有一个next指针,因为要动态添加新的类型与新的房间,在运用时需要大链表套小链表
	- 客人
	```c
	typedef struct CUSTOMER
	{
		int number;
		char ID[19];
		char name[20];
		enum VIP_LEVEL vip_level;
		struct CUSTOMER* next;
	}CUSTOMER;
	```
    
### 枚举变量与字符串
#### 字符串转换为枚举变量

为了方便管理员直观的理解所有枚举变量的含义,我们选择直接输入字符串,而后将其转换为枚举变量,为此需要一系列函数将输入转换为枚举变量.

- 房间位置
```c
enum LOCATION convert_location(char* str)
{
	if (strcmp(str, "north") == 0)
	{
		return north;
	}
	else if (strcmp(str, "south") == 0)
	{
		return south;
	}
	else if (strcmp(str, "near_lift") == 0)
	{
		return near_lift;
	}
	else if (strcmp(str, "near_corner") == 0)
	{
		return near_corner;
	}
}
```
- VIP等级
```c
enum VIP_LEVEL convert_vip_level(char* str)
{
	if (strcmp(str, "black") == 0)
	{
		return black;
	}
	else if (strcmp(str, "gold") == 0)
	{
		return gold;
	}
	else if (strcmp(str, "silver") == 0)
	{
		return silver;
	}
	else if (strcmp(str, "common") == 0)
	{
		return common;
	}
}
```
- 客人状态
```c
enum STATUS_CUS convert_status_cus(char* str)
{
	if (strcmp(str, "CUS_available") == 0)
	{
		return CUS_available;
	}
	else if (strcmp(str, "CUS_reserved") == 0)
	{
		return CUS_reserved;
	}
	else if (strcmp(str, "living") == 0)
	{
		return living;
	}
	else if (strcmp(str, "leave") == 0)
	{
		return leave;
	}
}
```
- 房间状态
```c
enum STATUS_ROOM convert_status_room(char* str)
{
	if (strcmp(str, "ROOM_available") == 0)
	{
		return ROOM_available;
	}
	else if (strcmp(str, "ROOM_reserved") == 0)
	{
		return ROOM_reserved;
	}
	else if (strcmp(str, "check_in") == 0)
	{
		return check_in;
	}
}
```
>这类函数重复性高,本质就是通过将输入与枚举变量相比返回对应的变量

### 枚举变量转换为字符串

存储在结构体的枚举变量以整型变量形式存在,这样不方便也不能直观的写入文件中,因此要编写一系列函数,将枚举变量转换为字符串

- 房间位置
```c
char*  reconvert_location(enum LOCATION type)
{
	if (type == 0)
	{
		return "north";
	}
	else if (type == 1)
	{
		return "south";
	}
	else if (type == 2)
	{
		return "near_lift";
	}
	else if (type == 3)
	{
		return "near_corner";
	}
}
```
- VIP等级
```c
char* reconvert_vip_level(enum VIP_LEVEL type)
{
	if (type == 0)
	{
		return "black";
	}
	else if (type == 1)
	{
		return "gold";
	}
	else if (type == 2)
	{
		return "silver";
	}
	else if (type == 3)
	{
		return "common";
	}
}
```
- 房间位置
```c
char*  reconvert_location(enum LOCATION type)
{
	if (type == 0)
	{
		return "north";
	}
	else if (type == 1)
	{
		return "south";
	}
	else if (type == 2)
	{
		return "near_lift";
	}
	else if (type == 3)
	{
		return "near_corner";
	}
}
```
- 客人状态
```c
char* reconvert_status_cus(enum STATUS_CUS type)
{
	if (type == 0)
	{
		return "CUS_available";
	}
	else if (type == 1)
	{
		return "CUS_reserved";
	}
	else if (type == 2)
	{
		return "living";
	}
	else if (type == 3)
	{
		return "leave";
	}
}
```
- 房间状态
```c
char* reconvert_status_room(enum STATUS_ROOM type)
{
	if (type == 0)
		return "ROOM_available";
	else if (type == 1)
		return "ROOM_reserved";
	else if (type == 2)
		return "check_in";
}
```